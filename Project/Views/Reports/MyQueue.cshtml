@model List<Gruppe4NLA.ViewModels.MyQueueItemVM>

@{
    ViewData["Title"] = "My Queue";
    var qsort = ViewBag.QSort ?? "AssignedAt";
    var qdir = ViewBag.QDir ?? "asc";
    
    string ToggleDir(string col)
    {
        if (qsort?.ToLower() == col.ToLower())
            return qdir == "asc" ? "desc" : "asc";
        return "asc";
    }
    
    string SortIcon(string col)
    {
        if (qsort?.ToLower() != col.ToLower()) return "";
        return qdir == "asc" ? "▲" : "▼";
    }
}

<h2>My Queue</h2>

@if (TempData["Ok"] != null)
{
    <div class="alert alert-success">@TempData["Ok"]</div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

@if (!Model.Any())
{
    <p>You have no assigned cases at the moment.</p>
}
else
{
    <table class="table table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>
                <a asp-action="MyQueue" asp-route-qsort="Sender" asp-route-qdir="@ToggleDir("Sender")">
                    Sender @SortIcon("Sender")
                </a>
            </th>
            <th>
                <a asp-action="MyQueue" asp-route-qsort="Organization" asp-route-qdir="@ToggleDir("Organization")">
                    Organization @SortIcon("Organization")
                </a>
            </th>
            <th>
                <a asp-action="MyQueue" asp-route-qsort="Type" asp-route-qdir="@ToggleDir("Type")">
                    Type @SortIcon("Type")
                </a>
            </th>
            <th>
                <a asp-action="MyQueue" asp-route-qsort="DateSent" asp-route-qdir="@ToggleDir("DateSent")">
                    Date Sent @SortIcon("DateSent")
                </a>
            </th>
            <th>Status</th>
            <th>
                <a asp-action="MyQueue" asp-route-qsort="AssignedAt" asp-route-qdir="@ToggleDir("AssignedAt")">
                    Assigned At @SortIcon("AssignedAt")
                </a>
            </th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Id</td>
                <td>@item.SenderName</td>
                <td>@(item.Organization ?? "N/A")</td>
                <td>@item.Type</td>
                <td>@item.DateSent.ToString("yyyy-MM-dd HH:mm")</td>
                <td>
                    <span class="badge bg-@(item.StatusCase == Gruppe4NLA.Models.ReportStatusCase.Assigned ? "primary" : "warning")">
                        @item.StatusCase
                    </span>
                </td>
                <td>@item.AssignedAtUtc?.ToString("yyyy-MM-dd HH:mm")</td>
                <td>
                    <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info">View</a>
                </td>
            </tr>
        }
        </tbody>
    </table>
}

<a asp-action="Inbox" class="btn btn-secondary">Back to Inbox</a>